@if (subData) {
<div id="chart" class="chart-wrapper" [class.segment-selected]="selectedSegmentIndex !== null">
  <apx-chart
    class="ion-justify-content-start"
    [series]="chartOptions.series!"
    [chart]="chartOptions.chart!"
    [labels]="chartOptions.labels!"
    [dataLabels]="chartOptions.dataLabels!"
    [title]="chartOptions.title!"
    [fill]="chartOptions.fill!"
    [states]="chartOptions.states!"
    [plotOptions]="chartOptions.plotOptions!"
    [stroke]="chartOptions.stroke!"
    [theme]="chartOptions.theme!"
    [responsive]="chartOptions.responsive!"
  ></apx-chart>
  
  <!-- Overlay pour bloquer les cliques sur le donut -->
  @if (selectedSegmentIndex !== null) {
    <div class="donut-overlay" (click)="resetSegmentHighlight()"></div>
  }
  
  <!-- Texte central overlay -->
  <div class="chart-center-text">
    <div class="center-amount">{{ centerText.title }}</div>
    <div class="center-label">{{ centerText.subtitle }}</div>
  </div>
  
  <!-- Légende personnalisée sous forme de chips scrollables -->
  <div class="legend-chips">
    @for (label of labels; track $index) {
      <div class="chip" [class.active]="selectedSegmentIndex === $index" (click)="onChipTap($index)">
        <span class="chip-color" [style.background-color]="getChipColor($index)"></span>
        <span class="chip-name">{{ label }}</span>
        <span class="chip-amount">{{ series[$index] | number:'1.0-0' }} CHF</span>
        <span class="chip-percent">{{ getPercentage($index) }}%</span>
      </div>
    }
  </div>
</div>
} @else {
  <ion-loading trigger="open-loading" message="Loading..." [duration]="3000" spinner="circles"></ion-loading>
  <p>Loading...</p>
}